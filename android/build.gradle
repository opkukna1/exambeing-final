// This file is the single source of truth for all plugins and dependencies.
pluginManagement {
    repositories {
        google()
        mavenCentral()
        gradlePluginPortal()
    }
}

dependencyResolutionManagement {
    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
    repositories {
        google()
        mavenCentral()
    }
}

rootProject.name = 'android'
include ':app'

// This code applies the main app's settings to all plugins
try {
    def localProperties = new Properties()
    def localPropertiesFile = new File(rootProject.projectDir, 'local.properties')
    if (localPropertiesFile.exists()) {
        localPropertiesFile.withReader('UTF-8') { reader ->
            localProperties.load(reader)
        }
    }

    def flutterSdkPath = localProperties.getProperty('flutter.sdk')
    if (flutterSdkPath == null) {
        throw new GradleException("Flutter SDK not found. Define location with flutter.sdk in the local.properties file.")
    }

    apply from: "$flutterSdkPath/packages/flutter_tools/gradle/app_plugin_loader.gradle"
} catch (Exception e) {
    // Fallback for CI/CD environments
    apply from: '../../flutter/packages/flutter_tools/gradle/app_plugin_loader.gradle'
}
